-- =========================
-- PROFILES
-- =========================
create table if not exists profiles (
    id uuid primary key default gen_random_uuid(),
    name text not null,
    created_at timestamp default now()
);

-- =========================
-- ACCOUNTS
-- =========================
create table if not exists accounts (
    id bigserial primary key,
    user_id uuid not null,
    name text not null,
    type text not null,
    balance numeric default 0,
    created_at timestamp default now(),
    constraint fk_accounts_user
        foreign key (user_id)
        references profiles(id)
        on delete cascade
);

create unique index if not exists unique_account_per_user
on accounts(name, user_id);

-- =========================
-- TRANSACTIONS
-- =========================
create table if not exists transactions (
    id bigserial primary key,
    account_id bigint not null,
    amount numeric not null,
    type text not null,
    category text,
    description text,
    date timestamp default now(),
    constraint fk_transactions_account
        foreign key (account_id)
        references accounts(id)
        on delete cascade
);

-- =========================
-- BUDGETS
-- =========================
create table if not exists budgets (
    id bigserial primary key,
    user_id uuid not null,
    category text not null,
    month int not null,
    year int not null,
    limit_amount numeric not null,
    constraint fk_budgets_user
        foreign key (user_id)
        references profiles(id)
        on delete cascade
);
